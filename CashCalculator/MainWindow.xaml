<Window x:Class="CashCalculator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Cash Calculator beta 0.1"
        Height="625" Width="420"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource WindowForegroundBrush}">

  <Window.Resources>
    <!-- 1) Палитра -->
    <SolidColorBrush x:Key="WindowBackgroundBrush"                 Color="#FFF0F0F0"/>
    <SolidColorBrush x:Key="WindowForegroundBrush"                 Color="#FF1E1E1E"/>
    <SolidColorBrush x:Key="DataGridRowBackgroundBrush"            Color="#FFFFFFFF"/>
    <SolidColorBrush x:Key="DataGridAlternationRowBackgroundBrush" Color="#FFF7F7F7"/>
    <SolidColorBrush x:Key="DataGridBorderBrush"                   Color="#FFCCCCCC"/>
    <SolidColorBrush x:Key="AccentBrush"                           Color="#FF4F94CD"/>

    <!-- 2) Стили для DataGrid -->
    <Style x:Key="NiceGrid" TargetType="DataGrid">
      <Setter Property="AutoGenerateColumns" Value="False"/>
      <Setter Property="HeadersVisibility" Value="Column"/>
      <Setter Property="GridLinesVisibility" Value="None"/>
      <Setter Property="AlternationCount" Value="2"/>
      <Setter Property="RowBackground" Value="{StaticResource DataGridRowBackgroundBrush}"/>
      <Setter Property="AlternatingRowBackground" Value="{StaticResource DataGridAlternationRowBackgroundBrush}"/>
      <Setter Property="RowHeight" Value="28"/>
      <Setter Property="FontSize" Value="14"/>
      <Setter Property="BorderBrush" Value="{StaticResource DataGridBorderBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="SelectionMode" Value="Single"/>
      <Setter Property="SelectionUnit" Value="FullRow"/>
      <Setter Property="Margin" Value="0"/>
    </Style>
    <Style x:Key="NiceHeader" TargetType="DataGridColumnHeader">
      <Setter Property="Background" Value="{StaticResource DataGridBorderBrush}"/>
      <Setter Property="Foreground" Value="{StaticResource WindowForegroundBrush}"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="HorizontalContentAlignment" Value="Center"/>
      <Setter Property="FontSize" Value="14"/>
      <Setter Property="Padding" Value="5"/>
      <Setter Property="BorderThickness" Value="0,0,0,1"/>
      <Setter Property="BorderBrush" Value="{StaticResource DataGridBorderBrush}"/>
    </Style>
    <Style x:Key="NiceCell" TargetType="DataGridCell">
      <Setter Property="Padding" Value="5"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="HorizontalContentAlignment" Value="Center"/>
      <Setter Property="FontSize" Value="14"/>
    </Style>

    <!-- 3) «Плоская» кнопка с hover/press -->
    <Style x:Key="FlatButton" TargetType="Button">
      <Setter Property="OverridesDefaultStyle" Value="True"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderBrush" Value="Transparent"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="Opacity" Value="1"/>
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Opacity" Value="0.8"/>
        </Trigger>
        <Trigger Property="IsPressed" Value="True">
          <Setter Property="Opacity" Value="0.6"/>
        </Trigger>
      </Style.Triggers>
    </Style>

    <!-- 4) Источник с фильтром для номиналов -->
    <CollectionViewSource x:Key="DenomsViewSource" Filter="DenomsFilter"/>
  </Window.Resources>

  <Grid>
    <TabControl>
      <!-- Calculator Tab -->
      <TabItem Header="Calculator">
        <DockPanel Margin="10" LastChildFill="False">
          <!-- Таблица номиналов -->
          <Border x:Name="DenomBorder" CornerRadius="8"
                  Background="{StaticResource WindowBackgroundBrush}"
                  BorderBrush="{StaticResource DataGridBorderBrush}"
                  BorderThickness="1" Margin="0,0,0,10"
                  DockPanel.Dock="Top">
            <DataGrid x:Name="DenomsGrid"
                      Style="{StaticResource NiceGrid}"
                      ColumnHeaderStyle="{StaticResource NiceHeader}"
                      CellStyle="{StaticResource NiceCell}"
                      Background="Transparent"
                      CanUserAddRows="False"
                      ItemsSource="{Binding Source={StaticResource DenomsViewSource}}"
                      CellEditEnding="DenomsGrid_CellEditEnding"
                      PreviewTextInput="DataGrid_PreviewTextInput">
              <DataGrid.Columns>
                <DataGridTemplateColumn Header="" Width="Auto">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding StatusGlyph}"
                                 Foreground="{Binding StatusBrush}"
                                 FontSize="16"/>
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Номинал, ₽"
                                    Binding="{Binding Value}" Width="*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Кол-во"
                                    Binding="{Binding Amount,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                    Width="*"/>
              </DataGrid.Columns>
            </DataGrid>
          </Border>

          <!-- Таблица итогов -->
          <Border x:Name="SummaryBorder" CornerRadius="8"
                  Background="{StaticResource WindowBackgroundBrush}"
                  BorderBrush="{StaticResource DataGridBorderBrush}"
                  BorderThickness="1" Margin="0,0,0,10"
                  DockPanel.Dock="Top">
            <DataGrid x:Name="SummaryGrid"
                      Style="{StaticResource NiceGrid}"
                      ColumnHeaderStyle="{StaticResource NiceHeader}"
                      CellStyle="{StaticResource NiceCell}"
                      Background="Transparent"
                      CanUserAddRows="False"
                      HeadersVisibility="Column"
                      AutoGenerateColumns="False"
                      CellEditEnding="SummaryGrid_CellEditEnding"
                      PreviewTextInput="DataGrid_PreviewTextInput">
              <DataGrid.Columns>
                <DataGridTemplateColumn Header="" Width="Auto">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding StatusGlyph}"
                                 Foreground="{Binding StatusBrush}"
                                 FontSize="16"/>
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Итого, ₽"
                                    Binding="{Binding Description}"
                                    Width="0.8*" IsReadOnly="True"/>
                <DataGridTextColumn Header=""
                                    Binding="{Binding Value,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                    Width="*"/>
              </DataGrid.Columns>
            </DataGrid>
          </Border>

          <!-- Кнопки Copy и Clean -->
          <StackPanel Orientation="Horizontal"
                      DockPanel.Dock="Top"
                      HorizontalAlignment="Center"
                      Margin="0,0,0,10">
            <!-- Copy -->
            <Border CornerRadius="8"
                    Background="{StaticResource WindowBackgroundBrush}"
                    BorderBrush="{StaticResource DataGridBorderBrush}"
                    BorderThickness="1"
                    Padding="2"
                    Margin="0,0,10,0">
              <Button Style="{StaticResource FlatButton}"
                      Content="📋"
                      ToolTip="Copy to Clipboard"
                      Width="30" Height="30"
                      Click="CopyReport_Click"/>
            </Border>
            <!-- Clean -->
            <Border CornerRadius="8"
                    Background="{StaticResource WindowBackgroundBrush}"
                    BorderBrush="{StaticResource DataGridBorderBrush}"
                    BorderThickness="1"
                    Padding="2">
              <Button Style="{StaticResource FlatButton}"
                      Content="🧹"
                      ToolTip="Clean values (keep filters)"
                      Width="30" Height="30"
                      Click="Clean_Click"/>
            </Border>
          </StackPanel>

          <!-- Подпись -->
          <TextBlock DockPanel.Dock="Bottom"
                     Text="© 2025 Kremenchugskaya Team"
                     FontSize="10"
                     Foreground="{StaticResource DataGridBorderBrush}"
                     HorizontalAlignment="Center"/>
        </DockPanel>
      </TabItem>

      <!-- Settings Tab -->
      <TabItem Header="Settings">
        <ScrollViewer>
          <StackPanel Margin="10">
            <TextBlock FontWeight="Bold"
                       FontSize="14"
                       Margin="0,0,0,10"
                       Text="Отображать номиналы"/>
            <ItemsControl ItemsSource="{Binding DenominationFilters}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <CheckBox Content="{Binding Value, StringFormat='{}{0}₽'}"
                            IsChecked="{Binding IsVisible}"
                            Margin="0,0,0,5"/>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </ScrollViewer>
      </TabItem>
    </TabControl>
  </Grid>
</Window>