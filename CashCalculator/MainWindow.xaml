<!-- MainWindow.xaml -->
<Window x:Class="CashCalculator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:CashCalculator.Views"
        Title="Cash Calculator beta 0.2.1"
        Height="640" Width="420"
        ResizeMode="CanMinimize"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource WindowForegroundBrush}">

  <Window.Resources>
    <!-- для фильтрации номиналов -->
    <CollectionViewSource x:Key="DenomsViewSource"
                          Source="{Binding Denominations}"
                          Filter="DenomsFilter"/>
  </Window.Resources>

  <Grid>
    <TabControl>

      <!-- === Calculator Tab === -->
      <TabItem Header="Calculator">
        <Grid Margin="10">
          <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <DockPanel Grid.Row="0" LastChildFill="False">

            <!-- Таблица номиналов -->
            <Border CornerRadius="8"
                    Background="{StaticResource WindowBackgroundBrush}"
                    BorderBrush="{StaticResource DataGridBorderBrush}"
                    BorderThickness="1"
                    Margin="0 0 0 10"
                    DockPanel.Dock="Top">
              <DataGrid x:Name="DenomsGrid"
                        ItemsSource="{Binding Source={StaticResource DenomsViewSource}}"
                        Style="{StaticResource NiceGrid}"
                        ColumnHeaderStyle="{StaticResource NiceHeader}"
                        CellStyle="{StaticResource NiceCell}"
                        Background="Transparent"
                        CanUserAddRows="False"
                        CellEditEnding="DenomsGrid_CellEditEnding"
                        PreviewTextInput="DataGrid_PreviewTextInput"
                        PreviewMouseLeftButtonDown="DenomsGrid_PreviewMouseLeftButtonDown">
                <DataGrid.Columns>
                  <DataGridTextColumn Header="Номинал, ₽"
                                      Binding="{Binding Value}"
                                      Width="*"
                                      IsReadOnly="True"/>
                  <DataGridTextColumn Header="Кол-во"
                                      Binding="{Binding Amount,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                      Width="*"/>
                </DataGrid.Columns>
              </DataGrid>
            </Border>

            <!-- Таблица итогов -->
            <Border CornerRadius="8"
                    Background="{StaticResource WindowBackgroundBrush}"
                    BorderBrush="{StaticResource DataGridBorderBrush}"
                    BorderThickness="1"
                    Margin="0 0 0 10"
                    DockPanel.Dock="Top">
              <DataGrid x:Name="SummaryGrid"
                        ItemsSource="{Binding SummaryItems}"
                        Style="{StaticResource NiceGrid}"
                        ColumnHeaderStyle="{StaticResource NiceHeader}"
                        CellStyle="{StaticResource NiceCell}"
                        Background="Transparent"
                        CanUserAddRows="False"
                        AutoGenerateColumns="False"
                        CellEditEnding="SummaryGrid_CellEditEnding"
                        PreviewTextInput="DataGrid_PreviewTextInput"
                        PreviewMouseLeftButtonDown="SummaryGrid_PreviewMouseLeftButtonDown">
                <DataGrid.Columns>
                  <DataGridTemplateColumn Header="" Width="Auto">
                    <DataGridTemplateColumn.CellTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding StatusGlyph}"
                                   Foreground="{Binding StatusBrush}"
                                   FontSize="16"/>
                      </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                  </DataGridTemplateColumn>
                  <DataGridTextColumn Header="Итого, ₽"
                                      Binding="{Binding Description}"
                                      Width="0.8*"
                                      IsReadOnly="True"/>
                  <DataGridTextColumn Header=""
                                      Binding="{Binding Value,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                      Width="*"/>
                </DataGrid.Columns>
              </DataGrid>
            </Border>

            <!-- Панель действий -->
            <StackPanel Orientation="Horizontal"
                        DockPanel.Dock="Top"
                        HorizontalAlignment="Center"
                        Margin="0 0 0 10">
              <views:ToolbarView x:Name="ToolbarView"/>
            </StackPanel>

          </DockPanel>

          <!-- Футер -->
          <TextBlock Grid.Row="1"
                     Text="© 2025 Kremenchugskая Team"
                     FontSize="10"
                     Foreground="{StaticResource DataGridBorderBrush}"
                     HorizontalAlignment="Center"
                     Margin="0 5"/>

          <!-- Наш нумпад -->
          <views:NumpadView x:Name="NumpadView"/>

        </Grid>
      </TabItem>

      <!-- === Settings Tab === -->
      <TabItem Header="Settings">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <ScrollViewer Grid.Row="0">
            <StackPanel Margin="10">
              <TextBlock FontWeight="Bold" FontSize="14" Margin="0 0 0 10" Text="Show Denominations"/>
              <ItemsControl ItemsSource="{Binding DenominationFilters}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <CheckBox Content="{Binding Value, StringFormat='{}{0}₽'}"
                              IsChecked="{Binding IsVisible}"
                              Margin="0 0 0 5"/>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
              <Separator Margin="0 15 0 15"/>
              <TextBlock FontWeight="Bold" FontSize="14" Margin="0 0 0 10" Text="Instructions"/>
              <StackPanel>
                <TextBlock Text="📋 — Copy report"       Margin="0 0 0 4"/>
                <TextBlock Text="🧹 — Clear counts"      Margin="0 0 0 4"/>
                <TextBlock Text="🔢 — Toggle touch mode" Margin="0 0 0 4"/>
                <TextBlock Text="⌫ — Backspace last digit" Margin="0 0 0 4"/>
                <TextBlock Text="✓ or Enter — Confirm input" Margin="0 0 0 4"/>
              </StackPanel>
            </StackPanel>
          </ScrollViewer>
          <TextBlock Grid.Row="1"
                     Text="© 2025 Kremenchugskая Team"
                     FontSize="10"
                     Foreground="{StaticResource DataGridBorderBrush}"
                     HorizontalAlignment="Center"
                     Margin="0 5"/>
        </Grid>
      </TabItem>

    </TabControl>
  </Grid>
</Window>